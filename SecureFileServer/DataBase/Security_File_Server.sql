
DROP DATABASE IF EXISTS `File_Server`;
CREATE DATABASE `File_Server`;
USE `File_Server`;

SET time_zone = "+08:00";

CREATE TABLE `Users` (
  `username` varchar(255) Unique NOT NULL,
  `password`  binary(60) NOT NULL,
  `role` varchar(255) NOT NULL DEFAULT 'user',
  `lastLoginTime` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `salt` binary(29) NOT NULL,
  `publicKey` VarBinary (2048) NOT NULL,
  PRIMARY KEY (`username`)
);

INSERT INTO `Users` (`username`, `password`, `role`, `lastLoginTime`, `salt`, `publicKey`) VALUES
('admin1', 0x2432622431322450792f307764777a48696b6f364c374e70525a776d65545531633559555074434f6f754e4f564233456e562e64746c796c7842662e, 'admin', '2025-03-25 12:16:17', 0x2432622431322450792f307764777a48696b6f364c374e70525a776d65, 0x2d2d2d2d2d424547494e205055424c4943204b45592d2d2d2d2d0a4d494942496a414e42676b71686b6947397730424151454641414f43415138414d49494243674b43415145417876655046542f6d35386e73375548494d6d56700a746142727334617177617335525564526a546c67497251505a6943484848645943554e7334747270343651332b4c6d4f75516b4b3072593048746d526b694d4b0a496656302f6d56524a55425454376a412f316a644b684a346c367a6f6a327777464652794c7945633452347a31316c7131357552673966675241306d476d504f0a61745139425953464f5a6d637267692f71516d682f3174587344665637616465447279376774373332464341372b67512b622b35492b424438307069575267720a514b5738466367695a2b3454303734492b482f726742496478355262765044746f796b726a6b4c664133526130584f7866616344394d61524a797978346656350a6b465632325344364371307656704534306273397244536b434274652b43436639462b767843615979635a446a31503668307a56642b774577704c73545261380a30514944415141420a2d2d2d2d2d454e44205055424c4943204b45592d2d2d2d2d),
('user1', 0x2432622431322430746a3252465543305475474c7473634a58722e7a654677536c6a795876344472434d6235646964466447417a68666a666e596453, 'user', '2025-03-25 11:53:08', 0x2432622431322430746a3252465543305475474c7473634a58722e7a65, 0x2d2d2d2d2d424547494e205055424c4943204b45592d2d2d2d2d0a4d494942496a414e42676b71686b6947397730424151454641414f43415138414d49494243674b4341514541344a57785978533148746c6773574d43365262530a467a37707041626249385732777671434f64786d4f754c4f5178454c4275573571433246764c5a4267336461324a4e503463506c687138666d71456e7572676f0a75644c7255595438477478374f696a74427538523853436b3874705739332f372f574d6139456330344448545070787845495041316e6f37653531426a4d614b0a78354f4f425473612f712b3561724245397347596d4972657568665375702b5a5a42765654364758565241476a506f6d5a706d434b2f6d674d577474627068590a42704e754d512f36616c7263377357796c65437178336966674e4b2f6c5978794374725a334a5442662b4578627a76782b73444e344543334a6335675a71636c0a5557586464384b70333349336a2b4a777572444b647353512b614e4a53564e53496f79772f63314c7251723556744e6179754339514f7a617842645641576b460a43514944415141420a2d2d2d2d2d454e44205055424c4943204b45592d2d2d2d2d),
('user2', 0x2432622431322465373076565357302f65703448525a65675443315a2e3375674e45487659424a3955336a582e74506d324e4b717a30533875306c53, 'user', '2025-03-25 11:54:44', 0x2432622431322465373076565357302f65703448525a65675443315a2e, 0x2d2d2d2d2d424547494e205055424c4943204b45592d2d2d2d2d0a4d494942496a414e42676b71686b6947397730424151454641414f43415138414d49494243674b4341514541716a72766e42654569694e425758436863784d420a7742753773374773705963514d45466a376c6c2f746c71476b734c4444774163637549306e5248787962336a7077465342645462382b4a5471756e7a615168560a4e6530584c4a4b666952676f4c796f6448746f41337142594e3149494d6b69767242553447336f784c61444178794435756c514834736f6a526552746d6566450a634e394348614661427174537575364345676c422f6f2b7a517836652f484a7a77303045527668526a434a46663865417051445163595852795262756a3635540a6837526d485547693742633949585a79797638446d366a6e46723845664649573762556f5646713436695a584739756a7170504d676c525747657853756561440a6850657742597144412b32352b45365a723945663873614e38626e6264792f31342f666a33494a366f6d747177764a756d576456656c636c53742b6e3345466f0a39514944415141420a2d2d2d2d2d454e44205055424c4943204b45592d2d2d2d2d);


CREATE TABLE `Files` (
  `fileID` int NOT NULL AUTO_INCREMENT,
  `fileName` varchar(255) NOT NULL,
  `fileOwner` varchar(255) NOT NULL,
  `filePath` varchar(255) NOT NULL,
  `fileSize` int NOT NULL DEFAULT 0,
  `fileUploadTime` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `fileModifyTime` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`fileID`),
  FOREIGN KEY (fileOwner) REFERENCES Users(username)
);

INSERT INTO `Files` (`fileID`, `fileName`, `fileOwner`, `filePath`, `fileSize`, `fileUploadTime`, `fileModifyTime`) VALUES
(1, '天空塌下前.txt', 'user2', './File_Storage/user2/Owner/天空塌下前.txt', 1536, '2025-03-25 11:55:54', '2025-03-25 11:55:54');

CREATE TABLE `Permissions` (
  `fileID` int NOT NULL,
  `username` varchar(255) NOT NULL,
  FOREIGN KEY (fileID) REFERENCES Files(fileID),
  FOREIGN KEY (username) REFERENCES Users(username)
);

INSERT INTO `Permissions` (`fileID`, `username`) VALUES
(1, 'user1');